<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
    <head>
        <title>Input page</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="JS/jquery.js"></script>
        <script src="JS/bootstrap.js"></script>
        <link href="CSS/bootstrap.css" rel="stylesheet">
        <link href="CSS/bootstrap-responsive.css" rel="stylesheet">
        <script>
            function preparePage() {
                $("#headerInputData").addClass("active");
                $("#leftInputData").addClass("active");
                getDepartments();
            }
            function getDepartments() {
                $.ajax ({
                   url: "map/getDepartments",
                   dataType: "json",
                   success: function(data) {
                        $.each(data, function(key, val) {
                            $("#selectDepartment").append("<option id=\"" + val.dep_id + "\">" + val.title + "</option>");
                        });
                   },
                   error: function() {
                       $("#serverAnswer").html("Failed. Please try again").addClass("alert").addClass("alert-info");
                   }
                });
            }
            function verifyNameForm(fieldId) {
                if ($("#" + fieldId).val().length < 1) $("#" + fieldId + "Place").html("Слишком мало символов!");
                else if ($("#" + fieldId).val().length > 50) $("#" + fieldId + "Place").html("Слишком много символов!");
                else if (!$("#" + fieldId).val().match("^[а-яА-Я]+$")) $("#" + fieldId + "Place").html("Только буквы а-Я разрешены!");
                else $("#" + fieldId + "Place").html("Ок");
            }
            function checkForm() {
                if (!($("#inputSurnamePlace").html() == "Ок") || !($("#inputNamePlace").html() == "Ок")) {
                    $("#serverAnswer").html("Заполните верно имя и фамилию!").addClass("alert").addClass("alert-error");
                } else {
                    console.log("Testing ----------" + $("#inputSurnamePlace").html() + " " + $("#inputNamePlace").html());
                    $("#serverAnswer").html("").removeClass("alert").removeClass("alert-error");
                    sendForm();
                }
            }
            function sendForm() {
                $("#submitButton").addClass("disabled").html("Ожидайте...");
                var passing = {};
                passing["name"] = $("#inputName").val();
                passing["surname"] = $("#inputSurname").val();
                passing["telephone"] = $("#inputTelephone").val();
                passing["address"] = $("#inputAddress").val();
                var department = {};
                department["title"] = $("#selectDepartment").val();
                department["dep_id"] = $("#selectDepartment").children(":selected").attr("id");
                passing["department"] = department;
                console.log(JSON.stringify(passing));
                $.ajax ({
                    url: "map/submitemployee",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(passing),
                    success: function(data) {
                        if (data == "failure") {
                            $("#serverAnswer").html("Ошибка.").addClass("alert").addClass("alert-error");
                        } else {
                            $("#serverAnswer").html("Сотрудник успешно внесен!").addClass("alert").addClass("alert-success");
                        }
                    },
                    error: function() {
                        $("#serverAnswer").html("Ошибка. Попробуйте еще раз.").addClass("alert").addClass("alert-error");
                    },
                    complete: function() {
                        $("#submitButton").removeClass("disabled").html("Отправить");
                    }
                });
            }
        </script>
    </head>
    <body onload="preparePage()">
        <div class="navbar" id="topHeader">
            <div class="navbar-inner">
                <div class="container">
                    <a class="brand" href="index.html">Test app</a>
                    <div class="navbar-content">
                        <ul class="nav nav-pills">
                            <li id="headerHomeData">
                                <a href="index.html">Домашняя</a>
                            </li>
                            <li id="headerInputData">
                                <a href="input.html">Ввод данных</a>
                            </li>
                            <li id="headerShowData">
                                <a href="output.html">Обзор</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span3" id="leftMenu">
                <ul class="nav nav-tabs nav-stacked">
                            <li id="leftHomeData">
                                <a href="index.html">Домашняя</a>
                            </li>
                            <li class="divider"></li>
                            <li id="leftInputData">
                                <a href="input.html">Ввод данных</a>
                            </li>
                            <li class="divider"></li>
                            <li id="leftShowData">
                                <a href="output.html">Обзор</a>
                            </li>
                </ul>
            </div>
            <div class="span1">
            </div>
            <div class="span7" id="inputPlace">

                <form class="form-horizontal">
                    <div class="control-group">
                        <label class="control-label" for="inputName">Введите имя</label>
                        <div class="controls">
                            <input type="text" id="inputName" placeholder="Имя" onblur="verifyNameForm('inputName')">
                            <a id="inputNamePlace"></a>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="inputSurname">Введите фамилию</label>
                        <div class="controls">
                            <input type="text" id="inputSurname" placeholder="Фамилия" onblur="verifyNameForm('inputSurname')">
                            <a id="inputSurnamePlace"></a>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="inputTelephone">Введите телефон</label>
                        <div class="controls">
                            <input type="text" id="inputTelephone" placeholder="0XX-XXX-XX-XX">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="inputAddress">Введите Адрес</label>
                        <div class="controls">
                            <input type="text" id="inputAddress" placeholder="Адрес">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="inputDepartment">Выберите департамент</label>
                        <div class="controls">
                            <select id="selectDepartment">
                                
                            </select>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="controls">
                        <a class="btn btn-primary" id="submitButton" onclick="checkForm()">Отправить</a>
                        </div>
                    </div>
                </form>
        <div class="row-fluid" id="serverAnswer">
        </div>
            </div>
            <div class="span1">
            </div>
        </div>
    </body>
</html>
